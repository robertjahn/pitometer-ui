<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <style>
                .topRow {position: absolute;top:0px;left: 0px;bottom: 50%; right: 100%;background-color: #33342D;}
                .bottomRow {position: absolute;top:50%;left: 0px;bottom: 100%; right: 100%;background-color: #33342D;}
                .form-control {resize:vertical;}
                label {font-weight: bold;}
        </style>
        <title>Welcome to the Keptn Pitometer UI</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    </head>

    <body>
        <div class="container-fluid">            
            <div class="row">
                <div class="col-sm-1"><h5>Pitometer UI by </h5><a class="navbar-brand" href="https://www.keptn.sh"><svg style="width:100%" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 139.8 44" style="enable-background:new 0 0 139.8 44;" xml:space="preserve"> <style type="text/css"> .st0{fill:#006BB8;} .st1{fill:#002C66;} </style> <g> <g> <path class="st0" d="M33.5,6.9l-2.1-1L8.4,34.4l1.5,1.9c0.1,0.1,0.2,0.2,0.2,0.3L33.8,7.1C33.7,7,33.6,7,33.5,6.9z"></path> <polygon class="st0" points="13,37.2 16.5,37.2 35.8,13.2 35.1,9.8 		"></polygon> <polygon class="st0" points="26.4,3.5 15.7,16.8 15.7,16.8 15.7,16.8 5,30.1 6.7,32.2 28.8,4.7 		"></polygon> <path class="st0" d="M26.3,37.2c0.8,0,1.5-0.4,2-0.9l9.1-11.4c0.5-0.6,0.7-1.4,0.5-2.1l-1.4-6.2L20,37.2H26.3z"></path> <path class="st0" d="M13.2,12c-1-0.8-2.3-0.6-3.1,0.3c-0.8,1-0.6,2.3,0.3,3.1c1,0.8,2.3,0.6,3.1-0.3l0,0 C14.3,14.1,14.2,12.7,13.2,12z"></path> <path class="st0" d="M8.8,17.5c-2.1-1.7-2.5-4.8-0.7-6.9s4.8-2.5,6.9-0.7c0.6,0.5,1.1,1.1,1.4,1.8l7.5-9.4l-3.4-1.7 c-0.7-0.3-1.5-0.3-2.2,0L5.2,6.9c-0.4,0.2-0.7,0.5-1,0.8C4,8,3.9,8.3,3.8,8.6L0.5,22.8c-0.2,0.7,0,1.5,0.5,2.1l2.3,3l7.5-9.4 C10.1,18.3,9.4,18,8.8,17.5z"></path> </g> <g> <path class="st1" d="M68.3,28.3c0-1.6,0.2-3,0.7-4.2c0.5-1.2,1.1-2.2,1.9-3s1.7-1.4,2.7-1.8c1-0.4,2-0.6,3.1-0.6 c2.5,0,4.4,0.8,5.8,2.3c1.4,1.5,2.1,3.8,2.1,6.9c0,0.2,0,0.5,0,0.8c0,0.3,0,0.5-0.1,0.8H72.7c0.1,1.4,0.6,2.6,1.5,3.4 c0.9,0.8,2.2,1.2,4,1.2c1,0,1.9-0.1,2.8-0.3c0.8-0.2,1.5-0.4,2-0.6l0.6,3.4c-0.2,0.1-0.5,0.2-1,0.4c-0.4,0.1-0.9,0.2-1.4,0.4 c-0.5,0.1-1.1,0.2-1.7,0.3c-0.6,0.1-1.2,0.1-1.8,0.1c-1.6,0-3-0.2-4.1-0.7c-1.2-0.5-2.1-1.1-2.9-2c-0.8-0.8-1.3-1.8-1.7-3 C68.5,30.9,68.3,29.7,68.3,28.3z M80.5,26.4c0-0.6-0.1-1.1-0.2-1.6c-0.2-0.5-0.4-1-0.7-1.3c-0.3-0.4-0.7-0.7-1.1-0.9 s-1-0.3-1.6-0.3c-0.6,0-1.2,0.1-1.7,0.4c-0.5,0.2-0.9,0.6-1.2,1c-0.3,0.4-0.6,0.8-0.8,1.3c-0.2,0.5-0.3,1-0.4,1.5L80.5,26.4 L80.5,26.4z"></path> <path class="st1" d="M105.1,28.2c0,1.4-0.2,2.6-0.5,3.8c-0.4,1.2-0.9,2.1-1.5,3c-0.7,0.8-1.5,1.5-2.5,1.9c-1,0.5-2.1,0.7-3.4,0.7c-0.8,0-1.6-0.1-2.4-0.3c-0.7-0.2-1.3-0.4-1.8-0.7v7h-4.2V19.8c0.8-0.2,1.9-0.5,3.1-0.7c1.2-0.2,2.6-0.3,3.9-0.3c1.4,0,2.7,0.2,3.8,0.7c1.1,0.4,2.1,1.1,2.9,1.9c0.8,0.8,1.4,1.8,1.8,3C104.9,25.5,105.1,26.8,105.1,28.2z M100.8,28.3c0-1.9-0.4-3.3-1.3-4.4c-0.8-1-2.2-1.5-4.1-1.5c-0.4,0-0.8,0-1.2,0.1c-0.4,0-0.8,0.1-1.3,0.2V33c0.4,0.2,0.9,0.5,1.5,0.7c0.6,0.2,1.3,0.3,1.9,0.3c1.5,0,2.6-0.5,3.3-1.5C100.5,31.4,100.8,30,100.8,28.3z"></path><path class="st1" d="M109,14.4l4.2-0.7v5.5h6.4v3.5h-6.4V30c0,1.4,0.2,2.5,0.7,3.1c0.5,0.6,1.2,0.9,2.4,0.9c0.8,0,1.4-0.1,2-0.2c0.6-0.2,1.1-0.3,1.4-0.5l0.7,3.3c-0.5,0.2-1.1,0.4-1.9,0.6c-0.8,0.2-1.7,0.3-2.8,0.3c-1.3,0-2.4-0.2-3.2-0.5c-0.9-0.4-1.5-0.8-2.1-1.5c-0.5-0.7-0.9-1.4-1.1-2.4c-0.2-0.9-0.3-2-0.3-3.2L109,14.4L109,14.4z"></path><path class="st1" d="M124.3,19.8c0.8-0.2,1.9-0.5,3.1-0.7c1.3-0.2,2.7-0.3,4.3-0.3c1.5,0,2.7,0.2,3.7,0.6c1,0.4,1.8,1,2.4,1.7c0.6,0.7,1,1.6,1.2,2.6c0.2,1,0.4,2.1,0.4,3.4v10.2h-4.2v-9.5c0-1-0.1-1.8-0.2-2.5c-0.1-0.7-0.3-1.2-0.6-1.7c-0.3-0.4-0.7-0.7-1.2-0.9c-0.5-0.2-1.1-0.3-1.8-0.3c-0.5,0-1.1,0-1.7,0.1c-0.6,0.1-1,0.1-1.3,0.2v14.6h-4.2L124.3,19.8L124.3,19.8z"></path><g><path class="st1" d="M66.9,37.2h-4.9l-7-8.4v8.4h-4.2V10.8l4.2-0.7v15.9c0.5-0.6,1.1-1.2,1.7-1.8c0.6-0.6,1.2-1.3,1.8-1.9c0.6-0.6,1.1-1.3,1.7-1.9s1-1.1,1.3-1.5h5c-1.2,1.3-2.4,2.7-3.7,4c-1.3,1.4-2.8,3.2-4.1,4.5L66.9,37.2z"></path></g></g></g></svg></a></div>
                <div class="col">
                    <div class="form-group">
                        <label for="start">Test Context: Groups your test results</label>
                        <input type="text" id="context" class="form-control" value="testproject/pre-prod/serviceA" />
                        <small id="context_help" class="form-text text-muted">Pitometer uses this name to store your test runs in Mongo</small>
                    </div>
                </div>
                <div class="col">                        
                    <div class="form-group">
                        <label for="perfspec">Perfspec file (file or url)</label>
                        <input type="text" id="perfspec" class="form-control" value="./samples/perfspec.json" />
                        <small id="perfspec_help" class="form-text text-muted">Local perfspec file or a public URL</small>
                    </div>
                </div>                
                <div class="col">
                    <div class="form-group">
                        <label for="tags">Tag array (Optional)</label>
                        <textarea style="height:80px;" id="tags" class="form-control">["environment:prod-keptnsample","service:simplenodeservice"]</textarea>
                        <small id="perfspec_help" class="form-text text-muted">If provided, replaces TAG_PLACEHOLDER in perfspec file.  Leave blank to not replace.</small>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="comparecontext">Compare With</label>
                        <input type="text" id="comparecontext" class="form-control" value="" />
                        <small id="comparecontext_help" class="form-text text-muted">Options: EMPTY=compare w last good run; TEST RUN INDEX; Pitometer Query</small>
                    </div>
                </div>
            </div>    
            
            <hr>            
            
            <div class="row">
                <div class="col-sm-1">
                    <button id="singlerun" class="btn btn-info btn-block">Run</button>
                    <small id="comparecontext_help" class="form-text text-muted">YYYY-MM-DDTHH:MM:SS (T=seperator)</small>
                </div>        
                <div class="col">
                    <div class="row">
                        <div class="col-sm-2">                        
                            <div class="form-group">
                                <label for="starttime">Start Time</label>
                                <input type="text" id="starttime" class="form-control" value="2019-07-01T08:00:00" />
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="form-group">
                                <label for="endtime">End Time</label>
                                <input type="text" id="endtime" class="form-control" value="2019-07-01T09:00:00" />
                            </div>
                        </div>                        
                        <div class="col-sm-2">
                            <div class="form-group">
                                <label for="testRunName">Test Run Index</label>
                                <!--<input type="text" id="testRunName" class="form-control" value="TestRun_1" />-->
                                <input type="text" id="testRunName" class="form-control" value="1" />
                            </div>
                        </div>
                    </div>
                </div>            
            </div>
            <hr>
            <div class="row">
                <div class="col-sm-1">
                    <button id="multirun" class="btn btn-info btn-block">Multi Run</button>
                    <small id="comparecontext_help" class="form-text text-muted">YYYY-MM-DDTHH:MM:SS (T=seperator)</small>
                </div>        
                <div class="col">
                    <div class="row">
                        <div class="col-sm-2">                        
                            <div class="form-group">
                                <label for="start">Start Time</label>
                                <input type="text" id="start" class="form-control" value="2019-07-01T08:00:00" />
                            </div>
                        </div>
                        <!--
                        <div class="col-sm-2">
                            <div class="form-group">
                                <label for="testRunPrefix">Test Run Prefix</label>
                                <input type="text" id="testRunPrefix" class="form-control" value="TestRun_" />
                            </div>
                        </div> 
                        -->
                        <div class="col-sm-2">
                            <div class="form-group">
                                <label for="testRunIx">Test Run Start Index</label>
                                <input type="text" id="testRunIx" class="form-control" value="1" />
                            </div>
                        </div>   
                        <div class="col-sm-2">
                            <div class="form-group">
                                <label for="count"># of runs</label>
                                <input type="text" id="count" class="form-control" value="6" />
                            </div>
                        </div>
                        <div class="col-sm-2">
                            <div class="form-group">
                                <label for="length">Run duration (ms)</label>
                                <input type="text" id="length" class="form-control" value="60000" />
                            </div>
                        </div>                            
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-sm-1">
                    <button id="report" class="btn btn-success btn-block">Report</button>
                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="openinwindow">
                        <label class="form-check-label" for="openinwindow">New window?</label>
                    </div>                    
                </div>        
                <div class="col">
                    <div class="form-group">
                        <label for="reportquery">Query for Report</label>
                        <input type="text" class="form-control" id="reportquery" value="6" />
                        <small id="reportquery_help" class="form-text text-muted">Allowed values are number (=last X runs), string (=specific test run) or Query Object (e.g: { "find": { "result" :"pass"}, "sort" : {"timestamp" : 1}, "limit" :5})</small>
                    </div>
                </div>
                <div class="col-sm-1">
                </div>
                <div class="col-sm-2"><button id="cleardb" class="btn btn-danger btn-block">Clear Test Context from Database</button></div>
            </div>
        </div>

        <div class="rightColumn">
            <iframe id="iframe2" height="100%" width="100%" src="SELFURL/empty"></iframe>
        </div>

        <script>	
            function getRESTEndpoint() {
                 return window.location.href;
            }
                
            function executeCall(requestString, openinwindow) {
                var fullURL = getRESTEndpoint() + requestString;
                
                if(openinwindow)
                    window.open(fullURL);
                else
                    document.getElementById('iframe2').src = fullURL;
            }

            $("#cleardb").click(function () {	
                var context = $('#context').val();
                if(window.confirm("Do you really want to delete all data for '" + context + "'?")) {
                    executeCall("api/cleardb?context=" + context, false);
                }
            });            

            $("#singlerun").click(function () {
                if(window.confirm("Do you really want to run this single test '" + $('#testRunName').val() + "' ? Just want to make sure!")) {
                    var context = $('#context').val();
                    var perfspec = $('#perfspec').val();
                    var starttime = $('#starttime').val();
                    var endtime = $('#endtime').val();
                    var testRunName = $('#testRunName').val();
                    var tags = $('#tags').val();
                    var comparecontext = $('#comparecontext').val();
                    executeCall(
                        "api/singlerun?context=" + context + "&perfspec=" + perfspec + 
                        "&start=" + starttime + "&end=" + endtime + "&testRunName=" + testRunName + 
                        "&tags=" + tags + "&comparecontext=" + comparecontext, false);
                }
            });
            
            $("#multirun").click(function () {
                if(window.confirm("Do you really want to run these multiple test? Just want to make sure!")) {
                    var context = $('#context').val();
                    var perfspec = $('#perfspec').val();
                    var start = $('#start').val();
                    var length = $('#length').val();
                    var count = $('#count').val();
                    var testRunPrefix = $('#testRunPrefix').val();
                    var testRunIx = $('#testRunIx').val();
                    var tags = $('#tags').val();
                    var comparecontext = $('#comparecontext').val();
                    executeCall(
                        "api/multirun?context=" + context + "&perfspec=" + perfspec + 
                        "&start=" + start + "&length=" + length + "&count=" + count + 
                        "&testRunPrefix=" + testRunPrefix + "&testRunIx=" + testRunIx + 
                        "&tags=" + tags + "&comparecontext=" + comparecontext, false);
                }
            });

            $("#report").click(function () {	
                var context = $('#context').val();
                var reportquery = $('#reportquery').val();
                var openinwindow = $("#openinwindow")[0].checked;
                executeCall("api/report?context=" + context + "&reportquery=" + reportquery, openinwindow);
            });                 
        </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    </body>
</html>